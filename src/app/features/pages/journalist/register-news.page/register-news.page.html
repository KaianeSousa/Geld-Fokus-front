<div class="register-page">
  <main class="register-content">
    <div class="register-content__header">
      <h1 class="title">Publicar artigo</h1>
      <p class="subtitle">
        Prezado(a) jornalista, gostariamos de reforçar a importância de verificar sempre a veracidade das informações antes de publicá-las. É fundamental que todos os dados sejam corretos, pois a disseminação de notícias falsas acarretará em consequências legais. Contamos com sua responsabilidade e compromisso com a verdade.
      </p>
    </div>

    <form class="register-form" #registerForm="ngForm" (ngSubmit)="onSubmit(registerForm)">
      <div class="input-group">
        <label for="title">Título</label>
        <input
          type="text"
          id="title"
          name="title"
          class="input-group__input"
          placeholder="Escreva o título do artigo"
          [(ngModel)]="register.title"
          required
        />
      </div>

      <div class="input-group">
        <label for="category">Categoria</label>
      
        <div
          class="custom-select select-tags"
          (click)="toggleCategoryDropdown()"
          [class.open]="categoryDropdownOpen"
          tabindex="0"
          (keydown.enter)="toggleCategoryDropdown()"
          (keydown.space)="toggleCategoryDropdown()"
          (blur)="closeCategoryDropdown()"
          role="combobox"
          aria-haspopup="listbox"
          [attr.aria-expanded]="categoryDropdownOpen"
          aria-controls="category-options"
          aria-required="true"
        >
          <div class="selected-tags">
            @if(register.categoryName) {
              <span>{{ register.categoryName }}</span>
            } @else {
              <span class="selected-value">Selecione uma categoria</span>
            }
          </div>
          <span class="arrow">&#9662;</span>
      
          @if(categoryDropdownOpen) {
            <ul class="options-list" id="category-options" role="listbox">
              @for(category of (categoryState$ | async)?.availableCategories || []; track category.name) {
                <li
                  [class.selected]="register.categoryName === category.name"
                  (click)="selectCategory(category.name, $event)"
                  (keydown.enter)="selectCategory(category.name, $event)"
                  (keydown.space)="selectCategory(category.name, $event)"
                  tabindex="0"
                  role="option"
                  [attr.aria-selected]="register.categoryName === category.name"
                >
                  {{ category.name }}
                </li>
              }
            </ul>
          }
        </div>
        <input type="hidden" name="categoryName" [(ngModel)]="register.categoryName" required />
      </div>
      
      <div class="input-group">
        <label for="subtitle">Subtítulo</label>
        <input
          type="text"
          id="subtitle"
          name="subtitle"
          class="input-group__input"
          placeholder="Escreva o subtítulo do artigo"
          [(ngModel)]="register.subtitle"
          required
        />
      </div>

      <div class="input-group">
        <label for="content">Conteúdo do artigo</label>
        <textarea
          id="content"
          name="content"
          class="input-group__textarea"
          rows="10"
          placeholder="Escreva aqui o conteúdo do artigo..."
          [(ngModel)]="register.content"
          required
        ></textarea>
      </div>

      <div class="input-group">
        <label for="tags">Tags</label>
        <div
          class="custom-select select-tags"
          (click)="toggleDropdown()"
          [class.open]="dropdownOpen"
          tabindex="0"
          (keydown.enter)="toggleDropdown()"
          (keydown.space)="toggleDropdown()"
          (blur)="closeDropdown()"
          role="combobox"
          aria-haspopup="listbox"
          [attr.aria-expanded]="dropdownOpen"
          aria-controls="tags-options"
          aria-required="true"
        >
          <div class="selected-tags">
            @for (tag of register.tagNames; track tag) {
              <span class="tag-item">
                {{ tag }}
                <span
                  class="remove-tag"
                  (click)="removeTag(tag, $event); $event.stopPropagation()"
                  (keydown.enter)="removeTag(tag, $event); $event.stopPropagation()"
                  tabindex="0"
                  role="button"
                  aria-label="Remover tag"
                >×</span>
              </span>
            }

            @if (!register.tagNames.length) {
              <span class="selected-value">Selecione as tags</span>
            }
          </div>
          <span class="arrow">&#9662;</span>

          @if (dropdownOpen) {
            <ul class="options-list" id="tags-options" role="listbox">
              @for (tag of (newsState$ | async)?.availableTags || []; track tag.name) {
                <li
                  [class.selected]="register.tagNames.includes(tag.name)"
                  (click)="selectOption(tag.name, $event)"
                  (keydown.enter)="selectOption(tag.name, $event)"
                  (keydown.space)="selectOption(tag.name, $event)"
                  tabindex="0"
                  role="option"
                  [attr.aria-selected]="register.tagNames.includes(tag.name)"
                >
                  {{ tag.name }}
                </li>
              }
            </ul>
          }
        </div>
        <input type="hidden" name="tags"   [ngModel]="register.tagNames.join(',')" required />

        @if (registerForm.controls['tags'].touched && registerForm.controls['tags'].invalid) {
          <span class="error">Tags são obrigatórias.</span>
        }
      </div>

      <div class="input-group upload-group">
        <label for="coverImage">Upload de imagens</label>
        <div
          class="upload-container">
          <span class="file-name">{{ selectedFile ? selectedFile.name : 'Nenhum arquivo selecionado' }}</span>
          <button type="button" (click)="fileInput.click()">Selecionar Imagem</button>
          <input
            type="file"
            #fileInput
            hidden
            (change)="onFileSelected($event)"
          />
        </div>
      </div>

      <button type="submit" class="btn btn--primary">
        Publicar artigo
      </button>
    </form>
  </main>
</div>
